<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendar Appointment System</title>
  <style>
    :root {
      --primary-color: #212529;
      --secondary-color: #3f37c9;
      --accent-color: #f72585;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --success-color: #4cc9f0;
      --border-color: #dee2e6;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--light-color);
      color: var(--dark-color);
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      flex-direction: row;
      justify-content: space-around;
    }

    .calendar-container {
      position: relative;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      background-color: var(--primary-color);
      color: white;
    }

    .calendar-header h2 {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .calendar-nav {
      display: flex;
      gap: 10px;
    }

    .nav-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }

    .nav-btn:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: 600;
      background-color: var(--light-color);
      border-bottom: 1px solid var(--border-color);
    }

    .weekdays div {
      padding: 10px;
    }

    .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      padding: 5px;
    }

    .day {
      min-height: 60px;
      padding: 5px;
      border-radius: 5px;
      cursor: pointer;
      position: relative;
      transition: background-color 0.3s;
    }

    .day:hover {
      background-color: rgba(67, 97, 238, 0.1);
    }

    .day.today {
      background-color: rgba(67, 97, 238, 0.2);
      font-weight: bold;
    }

    .day.selected {
      background-color: var(--primary-color);
      color: white;
    }

    .day.other-month {
      color: #aaa;
    }

    .day-num {
      font-size: 0.9rem;
    }

    .event-dot {
      width: 8px;
      height: 8px;
      background-color: var(--accent-color);
      border-radius: 50%;
      position: absolute;
      bottom: 5px;
      right: 5px;
    }

    .appointment-panel {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: white;
      padding: 20px;
      border-top: 3px solid var(--primary-color);
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
      transform: translateY(100%);
      transition: transform 0.4s ease-in-out;
      z-index: 10;
    }

    .appointment-panel.active {
      transform: translateY(0);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .close-panel {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--dark-color);
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--dark-color);
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      font-size: 0.9rem;
    }

    .time-slots {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }

    .time-slot {
      padding: 8px 0;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .time-slot:hover {
      background-color: var(--light-color);
      border-color: var(--primary-color);
    }

    .time-slot.selected {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .time-slot.booked {
      background-color: #f8d7da;
      color: #721c24;
      cursor: not-allowed;
    }

    .btn {
      padding: 10px 15px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }

    .btn:hover {
      background-color: var(--secondary-color);
    }

    .events-list {
      max-height: 500px;
      max-width: 500px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      overflow: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--primary-color) #f1f1f1;
    }

    /* For WebKit browsers (Chrome, Edge, Safari) */
    .events-list::-webkit-scrollbar {
      width: 6px;
    }

    .events-header {
      padding: 20px;
      background-color: var(--primary-color);
      color: white;
    }

    .events-content {
      padding: 15px;
    }

    .event-item {
      background-color: #f8f9fa;
      border-left: 4px solid var(--dark-color);
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
    }

    .event-item .event-title {
      font-weight: 600;
      color: var(--dark-color);
    }

    .event-item .event-time {
      font-size: 0.85rem;
      color: #6c757d;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 5;
    }

    .overlay.active {
      display: block;
    }

    .day.fully-booked {
      pointer-events: none;
      /* Disable clicking */
      opacity: 0.5;
      /* Visually indicate unavailability */
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="calendar-container">
      <div class="calendar-header">
        <div class="calendar-nav">
          <button id="prevBtn" class="nav-btn">&#8249;</button>
        </div>
        <h2 id="month-year">February 2025</h2>
        <div class="calendar-nav">
          <button id="nextBtn" class="nav-btn">&#8250;</button>
        </div>
      </div>
      <div class="weekdays">
        <div>Sun</div>
        <div>Mon</div>
        <div>Tue</div>
        <div>Wed</div>
        <div>Thu</div>
        <div>Fri</div>
        <div>Sat</div>
      </div>
      <div id="days" class="days">
        <!-- Days will be generated by JavaScript -->
      </div>

      <div id="appointment-panel" class="appointment-panel">
        <div class="panel-header">
          <h3 id="selected-date">Appointment for February 27, 2025</h3>
          <button id="close-panel" class="close-panel">&times;</button>
        </div>
        <div class="form-group">
          <label>Available Time Slots</label>
          <div id="time-slots" class="time-slots">
            <!-- Time slots will be generated by JavaScript -->
          </div>
        </div>
        <div class="form-group">
          <label for="eventTitle">Appointment Title</label>
          <input type="text" id="eventTitle" placeholder="Enter appointment title">
        </div>
        <div class="form-group">
          <label for="eventDescription">Description (optional)</label>
          <input type="text" id="eventDescription" placeholder="Enter description">
        </div>
        <button id="saveBtn" class="btn">Save Appointment</button>
      </div>
    </div>

    <div class="events-list">
      <div class="events-header">
        <h3>Your Appointments</h3>
      </div>
      <div class="events-content" id="events-container">
        <!-- Events will be shown here -->
      </div>
    </div>
  </div>

  <div id="overlay" class="overlay"></div>

  <script>
    // DOM elements
    const monthYear = document.getElementById('month-year');
    const daysContainer = document.getElementById('days');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const appointmentPanel = document.getElementById('appointment-panel');
    const closePanel = document.getElementById('close-panel');
    const selectedDateEl = document.getElementById('selected-date');
    const timeSlotsContainer = document.getElementById('time-slots');
    const eventTitleInput = document.getElementById('eventTitle');
    const eventDescriptionInput = document.getElementById('eventDescription');
    const saveBtn = document.getElementById('saveBtn');
    const eventsContainer = document.getElementById('events-container');
    const overlay = document.getElementById('overlay');

    // Variables
    let currentDate = new Date();
    let selectedDate = null;
    let selectedTimeSlots = []; // Changed from a single value to an array
    let events = JSON.parse(localStorage.getItem('calendarEvents')) || {};

    // Available time slots (9 AM to 5 PM, hourly)
    const availableTimeSlots = [
      "9:00 AM", "10:00 AM", "11:00 AM", "12:00 PM",
      "1:00 PM", "2:00 PM", "3:00 PM", "4:00 PM", "5:00 PM"
    ];

    // Initialize calendar
    function initCalendar() {
      renderCalendar();
      displayEvents();

      prevBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      });

      nextBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      });

      closePanel.addEventListener('click', closeAppointmentPanel);
      overlay.addEventListener('click', closeAppointmentPanel);

      saveBtn.addEventListener('click', saveAppointment);
    }

    // Render calendar
    function renderCalendar() {
      const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      monthYear.textContent = `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
      daysContainer.innerHTML = '';

      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const firstDayIndex = firstDay.getDay();
      const totalDays = lastDay.getDate();
      const prevMonth = new Date(year, month, 0);
      const prevMonthDays = prevMonth.getDate();
      const today = new Date();

      // Days from previous month
      for (let i = firstDayIndex; i > 0; i--) {
        const dayEl = document.createElement('div');
        dayEl.classList.add('day', 'other-month');
        dayEl.innerHTML = `<div class="day-num">${prevMonthDays - i + 1}</div>`;
        daysContainer.appendChild(dayEl);
      }

      // Days for current month
      for (let i = 1; i <= totalDays; i++) {
        const dayEl = document.createElement('div');
        dayEl.classList.add('day');

        // Highlight today's date
        if (
          i === today.getDate() &&
          month === today.getMonth() &&
          year === today.getFullYear()
        ) {
          dayEl.classList.add('today');
        }

        dayEl.innerHTML = `<div class="day-num">${i}</div>`;

        // Format date key for the current day
        const dateStr = formatDateKey(new Date(year, month, i));

        // Calculate booked slots for the day
        let bookedSlots = [];
        if (events[dateStr]) {
          events[dateStr].forEach(event => {
            if (event.times) {
              bookedSlots.push(...event.times);
            } else if (event.time) {
              bookedSlots.push(event.time);
            }
          });
          bookedSlots = [...new Set(bookedSlots)]; // Remove duplicates
        }

        // If all available time slots are booked, mark the day as fully booked
        if (bookedSlots.length === availableTimeSlots.length) {
          dayEl.classList.add('fully-booked');
        } else {
          // Otherwise, make the day clickable to schedule an appointment
          dayEl.addEventListener('click', () => {
            // Remove selected class from all days
            document.querySelectorAll('.day').forEach(day => {
              day.classList.remove('selected');
            });

            dayEl.classList.add('selected');
            selectedDate = new Date(year, month, i);
            selectedTimeSlots = []; // Reset any previously selected time slots
            showAppointmentPanel();
          });
        }

        // Add event dot if there are any events
        if (events[dateStr] && events[dateStr].length > 0) {
          const eventDot = document.createElement('div');
          eventDot.classList.add('event-dot');
          dayEl.appendChild(eventDot);
        }

        daysContainer.appendChild(dayEl);
      }


      // Days for next month (to fill the calendar grid)
      const daysFromNextMonth = 42 - (firstDayIndex + totalDays);
      for (let i = 1; i <= daysFromNextMonth; i++) {
        const dayEl = document.createElement('div');
        dayEl.classList.add('day', 'other-month');
        dayEl.innerHTML = `<div class="day-num">${i}</div>`;
        daysContainer.appendChild(dayEl);
      }
    }

    // Show appointment panel
    function showAppointmentPanel() {
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      selectedDateEl.textContent = `Appointment for ${selectedDate.toLocaleDateString('en-US', options)}`;
      eventTitleInput.value = '';
      eventDescriptionInput.value = '';
      selectedTimeSlots = []; // Reset the array for new selections
      generateTimeSlots();
      appointmentPanel.classList.add('active');
      overlay.classList.add('active');
    }

    // Close appointment panel
    function closeAppointmentPanel() {
      appointmentPanel.classList.remove('active');
      overlay.classList.remove('active');
    }

    // Generate available time slots
    function generateTimeSlots() {
      timeSlotsContainer.innerHTML = '';
      const dateKey = formatDateKey(selectedDate);
      let bookedSlots = [];
      if (events[dateKey]) {
        events[dateKey].forEach(event => {
          // Handle events with multiple time slots
          if (event.times) {
            bookedSlots = bookedSlots.concat(event.times);
          } else if (event.time) {
            bookedSlots.push(event.time);
          }
        });
      }

      availableTimeSlots.forEach(time => {
        const timeSlotEl = document.createElement('div');
        timeSlotEl.classList.add('time-slot');

        // Mark time slots as booked if they exist in bookedSlots
        if (bookedSlots.includes(time)) {
          timeSlotEl.classList.add('booked');
          timeSlotEl.textContent = `${time} (Booked)`;
        } else {
          timeSlotEl.textContent = time;

          // Toggle selection for multiple time slots
          timeSlotEl.addEventListener('click', () => {
            if (selectedTimeSlots.includes(time)) {
              // Deselect if already selected
              selectedTimeSlots = selectedTimeSlots.filter(t => t !== time);
              timeSlotEl.classList.remove('selected');
            } else {
              // Select this time slot
              selectedTimeSlots.push(time);
              timeSlotEl.classList.add('selected');
            }
          });
        }
        timeSlotsContainer.appendChild(timeSlotEl);
      });
    }

    // Save appointment with multiple time slots
    function saveAppointment() {
      if (!selectedDate || selectedTimeSlots.length === 0) {
        alert('Please select a date and at least one time slot.');
        return;
      }
      if (!eventTitleInput.value.trim()) {
        alert('Please enter an appointment title.');
        return;
      }

      const dateKey = formatDateKey(selectedDate);
      const newEvent = {
        title: eventTitleInput.value.trim(),
        description: eventDescriptionInput.value.trim(),
        times: selectedTimeSlots, // Save multiple selected time slots
        date: selectedDate
      };

      if (!events[dateKey]) {
        events[dateKey] = [];
      }
      events[dateKey].push(newEvent);
      localStorage.setItem('calendarEvents', JSON.stringify(events));
      renderCalendar();
      displayEvents();
      closeAppointmentPanel();
      alert('Appointment saved successfully!');
    }

    // Display appointments
    function displayEvents() {
      eventsContainer.innerHTML = '';
      const sortedDates = Object.keys(events).sort((a, b) => new Date(a) - new Date(b));

      if (sortedDates.length === 0) {
        const noEvents = document.createElement('p');
        noEvents.textContent = 'No appointments scheduled.';
        noEvents.style.color = '#6c757d';
        noEvents.style.textAlign = 'center';
        noEvents.style.padding = '10px 0';
        eventsContainer.appendChild(noEvents);
        return;
      }

      sortedDates.forEach(dateKey => {
        const dateEvents = events[dateKey];
        if (dateEvents.length > 0) {
          const dateParts = dateKey.split('-');
          const eventDate = new Date(
            parseInt(dateParts[0]),
            parseInt(dateParts[1]) - 1,
            parseInt(dateParts[2])
          );
          const options = { weekday: 'short', month: 'short', day: 'numeric' };
          const formattedDate = eventDate.toLocaleDateString('en-US', options);

          dateEvents.forEach(event => {
            const eventEl = document.createElement('div');
            eventEl.classList.add('event-item');

            const eventTitle = document.createElement('div');
            eventTitle.classList.add('event-title');
            eventTitle.textContent = event.title;

            const eventTime = document.createElement('div');
            eventTime.classList.add('event-time');
            // Join multiple time slots if available
            let timesText = event.times ? event.times.join(', ') : event.time;
            eventTime.textContent = `${formattedDate} at ${timesText}`;

            eventEl.appendChild(eventTitle);
            eventEl.appendChild(eventTime);

            if (event.description) {
              const eventDesc = document.createElement('div');
              eventDesc.classList.add('event-desc');
              eventDesc.textContent = event.description;
              eventEl.appendChild(eventDesc);
            }

            eventsContainer.appendChild(eventEl);
          });
        }
      });
    }

    // Format date as key (YYYY-MM-DD)
    function formatDateKey(date) {
      const year = date.getFullYear();
      const month = date.getMonth() + 1; // Month is 0-indexed
      const day = date.getDate();
      return `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
    }

    // Initialize calendar on page load
    window.addEventListener('DOMContentLoaded', initCalendar);
  </script>

</body>

</html>